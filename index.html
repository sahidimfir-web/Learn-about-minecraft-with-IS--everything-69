<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worldopedia | Free encyclopedia</title>
    <style>
        :root {
            --neon-blue: #00f2ff; --neon-purple: #7000ff; --neon-green: #39ff14;
            --dark-bg: #050506; --card-bg: #111113; --glass: rgba(255,255,255,0.06);
            --content-width: 94%;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; margin: 0; }
        body { background: var(--dark-bg); color: #eee; font-family: 'Outfit', system-ui, sans-serif; overflow-x: hidden; }
        
        /* --- NAVIGATION --- */
        nav {
            position: fixed; top: 0; width: 100%; height: 65px; padding: 0 4%;
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(12px); border-bottom: 1px solid var(--glass); z-index: 5000;
        }

        #menu-btn { display: flex; align-items: center; gap: 12px; cursor: pointer; z-index: 5001; }
        .hamburger { width: 22px; height: 16px; display: flex; flex-direction: column; justify-content: space-between; position: relative; }
        .hamburger span { width: 100%; height: 2px; background: #fff; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* CROSS BUTTON TRANSFORM */
        .sidebar-active span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
        .sidebar-active span:nth-child(2) { opacity: 0; transform: translateX(10px); }
        .sidebar-active span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

        /* --- SIDEBAR --- */
        #sidebar {
            position: fixed; top: 0; left: -320px; width: 310px; height: 100vh;
            background: #0a0a0b; z-index: 4500; padding: 100px 30px; border-right: 1px solid var(--glass);
            transition: transform 0.4s cubic-bezier(0,0,0.2,1);
        }
        #sidebar.active { transform: translateX(320px); }

        /* --- SEARCH --- */
        .search-wrap { position: relative; max-width: 1000px; margin: 40px auto; width: 92%; }
        .main-search { 
            width: 100%; padding: 20px 35px; border-radius: 60px; border: 1px solid var(--glass); 
            background: #161618; color: #fff; font-size: 1.1rem; outline: none;
        }
        #suggest-box { 
            position: absolute; width: 100%; background: #1a1a1c; border-radius: 20px; 
            display: none; z-index: 6000; border: 1px solid var(--glass); margin-top: 10px; overflow: hidden;
        }

        /* --- GRID --- */
        .wide-container { width: var(--content-width); margin: 0 auto; max-width: 1920px; }
        .article-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(clamp(280px, 20vw, 400px), 1fr)); 
            gap: 25px; padding: 20px 0 100px; 
        }

        .card { background: var(--card-bg); border-radius: 15px; overflow: hidden; cursor: pointer; border: 1px solid var(--glass); transition: 0.3s; height: 100%; }
        .card:hover { border-color: var(--neon-blue); transform: translateY(-5px); }
        .card img { width: 100%; height: 230px; object-fit: cover; background: #111; display: block; }
        .card-body { padding: 22px; }

        /* --- DOSSIER VIEW --- */
        #dossier-view { display: none; padding: 110px 0 80px; }
        .dossier-header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: 40px; border-bottom: 1px solid var(--glass); padding-bottom: 25px; }
        .wiki-body { font-size: clamp(1.1rem, 1.2vw, 1.35rem); line-height: 1.7; color: #d5d5d5; }
        .wiki-body img { 
            float: right; margin: 10px 0 30px 40px; border-radius: 12px; 
            max-width: clamp(300px, 30vw, 500px); height: auto; border: 1px solid var(--glass); 
        }

        .btn { padding: 12px 24px; border-radius: 8px; border: none; font-weight: 900; cursor: pointer; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
        .btn-vault { background: var(--neon-green); color: #000; }
        .btn-vault.active { background: transparent; border: 1px solid var(--neon-green); color: var(--neon-green); }

        @media (max-width: 900px) {
            .wiki-body img { float: none; margin: 20px 0; max-width: 100%; }
            .dossier-header h1 { font-size: 1.8rem; width: 100%; }
        }
    </style>
</head>
<body>

<nav>
    <div id="menu-btn" onclick="toggleSidebar()">
        <div class="hamburger"><span></span><span></span><span></span></div>
        <span id="menu-text" style="font-size: 11px; font-weight: 900;">MENU</span>
    </div>
    <div style="font-weight:900; font-size:clamp(18px, 2vw, 24px); letter-spacing:4px; cursor:pointer;" onclick="location.hash=''">WORLDOPEDIA</div>
    <div id="auth-zone"><button class="btn" style="background:var(--neon-blue)" onclick="signIn()">Authorize</button></div>
</nav>

<aside id="sidebar">
    <div id="op-info" style="display:none; margin-bottom:40px;">
        <p style="font-size:10px; color:var(--neon-blue); letter-spacing:2px;">OPERATOR ID</p>
        <h2 id="op-name" style="margin:5px 0;"></h2>
        <p onclick="signOut()" style="font-size:9px; cursor:pointer; opacity:0.5;">[ DISCONNECT ]</p>
    </div>
    <p style="font-size:11px; font-weight:900; color:var(--neon-purple); margin-bottom:15px;">RECENT EXTRACTIONS</p>
    <div id="history-list"></div>
    <p style="font-size:11px; font-weight:900; color:var(--neon-green); margin:30px 0 15px;">SECURE VAULT</p>
    <div id="vault-list"></div>
</aside>

<main id="home-view" class="wide-container">
    <div style="padding: 120px 0 40px; text-align:center;">
        <h1 style="font-size: clamp(40px, 8vw, 100px); font-weight:900; line-height:0.9;">Worldopedia</h1>
        <div class="search-wrap">
            <input type="text" id="mainSearch" class="main-search" placeholder="Query the global archives..." autocomplete="off">
            <div id="suggest-box"></div>
        </div>
    </div>
    <div class="article-grid" id="latest-grid"></div>
</main>

<main id="dossier-view" class="wide-container">
    <div class="dossier-header">
        <h1 id="dos-title" style="font-size: clamp(2rem, 4vw, 4rem); font-weight:900;"></h1>
        <button id="vault-btn" class="btn btn-vault" onclick="toggleVault()">Vault +</button>
    </div>
    <div id="dos-content" class="wiki-body"></div>
</main>

<script>
    const cache = new Map();
    let activeUser = localStorage.getItem('worldo_user');

    window.addEventListener('hashchange', handleRoute);
    window.onload = () => { handleRoute(); renderSidebar(); if(activeUser) updateAuthUI(); };

    function handleRoute() {
        const hash = window.location.hash;
        if (hash.startsWith('#dossier/')) {
            const title = decodeURIComponent(hash.replace('#dossier/', ''));
            fetchArticle(title);
        } else {
            document.title = "Worldopedia | Global Intelligence";
            showHome();
        }
    }

    function showHome() {
        document.getElementById('home-view').style.display = 'block';
        document.getElementById('dossier-view').style.display = 'none';
        document.getElementById('menu-text').innerText = "MENU";
        document.getElementById('sidebar').classList.remove('active');
        document.getElementById('menu-btn').classList.remove('sidebar-active');
        loadFeed();
    }

    async function fetchArticle(title) {
        document.title = `${title.replace(/_/g, ' ')} | Worldopedia`;
        document.getElementById('home-view').style.display = 'none';
        document.getElementById('dossier-view').style.display = 'block';
        document.getElementById('dos-title').innerText = title.replace(/_/g, ' ');
        document.getElementById('dos-content').innerHTML = "Extracting data...";
        document.getElementById('suggest-box').style.display = 'none';
        
        checkVaultStatus(title);
        window.scrollTo(0,0);

        if(cache.has(title)) return renderContent(cache.get(title));

        const res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/html/${encodeURIComponent(title)}`);
        const html = await res.text();
        cache.set(title, html);
        renderContent(html);
        saveHistory(title);
    }

    function renderContent(html) {
        const target = document.getElementById('dos-content');
        target.innerHTML = html;
        target.querySelectorAll('img').forEach(img => {
            let src = img.getAttribute('src');
            if (src?.startsWith('./')) src = 'https://en.wikipedia.org/api/rest_v1/page/pdf/' + src.replace('./', '');
            if (src?.startsWith('//')) src = 'https:' + src;
            img.src = src;
            img.setAttribute('referrerpolicy', 'no-referrer');
        });
        target.querySelectorAll('a').forEach(link => {
            const href = link.getAttribute('href');
            if (href?.startsWith('./')) link.href = `#dossier/${href.replace('./', '')}`;
        });
    }

    function toggleVault() {
        if(!activeUser) return signIn();
        const title = window.location.hash.replace('#dossier/', '');
        let v = JSON.parse(localStorage.getItem(`worldo_v_${activeUser}`) || '[]');
        v = v.includes(title) ? v.filter(t => t !== title) : [title, ...v];
        localStorage.setItem(`worldo_v_${activeUser}`, JSON.stringify(v));
        checkVaultStatus(title);
        renderSidebar();
    }

    function checkVaultStatus(title) {
        const v = activeUser ? JSON.parse(localStorage.getItem(`worldo_v_${activeUser}`) || '[]') : [];
        const btn = document.getElementById('vault-btn');
        btn.innerText = v.includes(title) ? "IN VAULT" : "VAULT +";
        btn.classList.toggle('active', v.includes(title));
    }

    function toggleSidebar() {
        const side = document.getElementById('sidebar');
        if (!side.classList.contains('active') && window.location.hash) {
            window.location.hash = ''; return;
        }
        side.classList.toggle('active');
        document.getElementById('menu-btn').classList.toggle('sidebar-active');
        document.getElementById('menu-text').innerText = side.classList.contains('active') ? "CLOSE" : (window.location.hash ? "BACK" : "MENU");
    }

    async function loadFeed() {
        const res = await fetch(`https://en.wikipedia.org/api/rest_v1/feed/featured/${new Date().toISOString().split('T')[0].replace(/-/g, '/')}`);
        const data = await res.json();
        document.getElementById('latest-grid').innerHTML = data.mostread.articles.slice(0, 16).map(a => `
            <div class="card" onclick="location.hash='#dossier/${a.titles.canonical}'">
                <img src="${a.thumbnail ? a.thumbnail.source : ''}" loading="lazy">
                <div class="card-body">
                    <h3 style="margin-bottom:10px;">${a.titles.normalized}</h3>
                    <p style="font-size:13px; opacity:0.6; line-height:1.4;">${a.extract}</p>
                </div>
            </div>
        `).join('');
    }

    document.getElementById('mainSearch').addEventListener('input', async (e) => {
        const val = e.target.value.trim();
        if(val.length < 2) return;
        const res = await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&format=json&origin=*&search=${val}`);
        const data = await res.json();
        document.getElementById('suggest-box').innerHTML = data[1].map(t => `<div style="padding:15px 25px; cursor:pointer; border-bottom:1px solid var(--glass);" onclick="location.hash='#dossier/${t}'">${t}</div>`).join('');
        document.getElementById('suggest-box').style.display = 'block';
    });

    function signIn() {
        const n = prompt("Operator Codename:");
        if(n) { localStorage.setItem('worldo_user', n); activeUser = n; updateAuthUI(); renderSidebar(); }
    }
    function signOut() { localStorage.removeItem('worldo_user'); location.reload(); }
    function updateAuthUI() {
        document.getElementById('auth-zone').innerHTML = `<span style="font-size:11px; color:var(--neon-blue); font-weight:900;">OP: ${activeUser.toUpperCase()}</span>`;
        document.getElementById('op-info').style.display = 'block';
        document.getElementById('op-name').innerText = activeUser;
    }
    function saveHistory(t) {
        let h = JSON.parse(localStorage.getItem('worldo_h') || '[]');
        h = [t, ...h.filter(x => x !== t)].slice(0, 12);
        localStorage.setItem('worldo_h', JSON.stringify(h));
        renderSidebar();
    }
    function renderSidebar() {
        const h = JSON.parse(localStorage.getItem('worldo_h') || '[]');
        document.getElementById('history-list').innerHTML = h.map(t => `<div style="padding:8px 0; font-size:13px; cursor:pointer;" onclick="location.hash='#dossier/${t}'">${t.replace(/_/g, ' ')}</div>`).join('');
        if(activeUser) {
            const v = JSON.parse(localStorage.getItem(`worldo_v_${activeUser}`) || '[]');
            document.getElementById('vault-list').innerHTML = v.map(t => `<div style="padding:8px 0; font-size:13px; cursor:pointer; color:var(--neon-green);" onclick="location.hash='#dossier/${t}'">ðŸ”’ ${t.replace(/_/g, ' ')}</div>`).join('');
        }
    }
</script>
</body>
</html>